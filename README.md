# 表情アノテーションインターフェース

このWebアプリケーションは、動画の表情に対してアノテーション（ラベル付け）を行うためのインターフェースです。実験データとして活用可能な詳細なログ機能を備えています。

## プロジェクト構成

```
annotation_interface/
├── index.html              # メインのアノテーションインターフェース
├── style.css               # スタイルシート
├── script.js               # JavaScript機能実装
├── data.csv                # 動画リストファイル（固定）
├── data_test.csv           # テスト用動画リスト
├── data/                   # 動画ファイル格納フォルダ（Git管理外）
├── README.md               # このファイル
├── .gitignore              # Git除外設定
└── specifications.txt      # 仕様書
```

## 機能

### モード選択
- **モード1: 新規アノテーション** - 動画を見て新しくラベル付けを行います
- **モード2: ラベル付きアノテーション** - 既存ラベル（前のアノテータの回答）を確認しながらアノテーションします

### 主要機能
- **固定CSVファイル読み込み** - `data.csv`を自動読み込み（ファイル選択不要）
- **7つの基本感情のアノテーション**：怒り、嫌悪、恐怖、幸福、悲しみ、驚き、中立
- **前進のみワークフロー** - 戻る機能なし、確実な作業進行
- **動画自動再生** - ページ読み込み後に自動で動画再生
- **最後の動画でFinish機能** - NextボタンがFinishに変更、完了後はダウンロードボタン表示
- **詳細ログ記録** - 実験データ用の包括的なタイミング記録
- **操作制限** - 完了後は感情選択とボタンを無効化
- **詳細な感情説明ガイド**
- **進捗表示**
- **結果のCSV出力**
- **キーボードショートカット対応**

### 実験用ログ機能
以下の詳細データを記録：
- **アノテーション時間** - 動画開始から感情選択までの時間
- **選択変更回数** - ユーザーの迷いや再検討の指標
- **動画読み込み完了時刻** - システムパフォーマンス測定
- **Nextボタン押下時刻** - アノテーション後の確認時間
- **経過時間の詳細記録** - 各段階での所要時間

## クイックスタート

### 1. プロジェクトのクローン（Git使用時）
```bash
git clone <repository-url>
cd annotation_interface
```

### 2. データファイルの準備
アノテーション対象の動画ファイルを`data/`フォルダに配置し、`data.csv`ファイルを編集してください。

**data.csvの形式：**

**モード1用（ラベルなし）:**
```csv
ID,FilePath,Description
video_001,data/sample1.mp4,Sample emotion video 1
video_002,data/sample2.mp4,Sample emotion video 2
```

**モード2用（既存ラベルあり）:**
```csv
ID,FilePath,Description,Label
video_001,data/sample1.mp4,Sample emotion video 1,happy
video_002,data/sample2.mp4,Sample emotion video 2,sad
video_003,data/sample3.mp4,Sample emotion video 3,angry
```

### 3. アノテーション作業
1. **モード選択**：起動時にモードを選択（**一度選択すると変更不可**）
   - **モード1**: 新規アノテーション（既存ラベルなし）
   - **モード2**: ラベル付きアノテーション（前のアノテータの回答表示）
2. `index.html`をWebブラウザで開く
3. `data.csv`が自動的に読み込まれる
4. 動画が自動的に読み込まれ、自動再生される
5. モード2の場合、「あなたの前のアノテータの回答」が表示される
6. 適切な感情を選択（**必須** - Passボタンは削除済み）
7. 「Next」ボタンで次の動画に進む（戻る機能なし）
8. 最後の動画では「Finish」ボタンが表示される
9. Finish押下後、感情選択が無効化され、ダウンロードボタンが表示される

### 4. キーボードショートカット
- **右矢印キー**: 次の動画
- **数字キー 1-7**: 各感情の選択
  - 1: 怒り (Angry)
  - 2: 嫌悪 (Disgust) 
  - 3: 恐怖 (Fear)
  - 4: 幸福 (Happy)
  - 5: 悲しみ (Sad)
  - 6: 驚き (Surprise)
  - 7: 中立 (Neutral)

### 5. 結果の保存
全てのアノテーション作業が完了し、Finishボタンを押下後、「結果をダウンロード」ボタンが表示されます。クリックしてCSVファイルとして結果を保存してください。

## 出力ファイル形式

結果のCSVファイルには以下の詳細情報が含まれます：

### 基本情報
- **Video ID**: 動画の識別子
- **File Path**: 動画ファイルのパス
- **Emotion**: 選択された感情（angry, disgust, fear, happy, sad, surprise, neutral）
- **Status**: アノテーションの状態（annotated）
- **Timestamp**: 感情選択完了時刻（ISO 8601形式）

### 実験データ用詳細ログ
- **Annotation Time (seconds)**: アノテーション時間（動画開始から感情選択までの秒数）
- **Video Load Time**: 動画読み込み完了時刻（ISO 8601形式）
- **Selection Count**: 選択変更回数（ユーザーの迷いや再検討の指標）
- **Next Button Time**: Nextボタン押下時刻（ISO 8601形式）
- **Time to Next (seconds)**: 感情選択からNextボタン押下までの秒数

### サンプル出力
```csv
Video ID,File Path,Emotion,Status,Timestamp,Annotation Time (seconds),Video Load Time,Selection Count,Next Button Time,Time to Next (seconds)
"video_001","data/Action/angry/0022.mp4","angry","annotated","2025-07-15T10:30:45.123Z","3.45","2025-07-15T10:30:41.678Z","2","2025-07-15T10:30:50.234Z","5.11"
```

## テストデータ機能

### data_test.csvの使用
小規模なテスト用として`data_test.csv`（21動画、各感情3つずつ）を利用できます：

```bash
# テストデータに切り替え
mv data.csv data_backup.csv
mv data_test.csv data.csv

# 元に戻す
mv data.csv data_test.csv
mv data_backup.csv data.csv
```

## 技術仕様

### サポートされる動画形式
- MP4
- WebM
- OGV
- その他HTML5ビデオタグでサポートされる形式

### ブラウザ要件
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 注意事項

1. **動画ファイルの配置**: 動画ファイルは`data/`フォルダに配置し、`data.csv`には`data/filename.mp4`の形式でパスを指定してください。

2. **モード変更**: 一度モードを選択すると、アプリケーションを再起動するまで変更できません。

3. **データファイル**: `data.csv`ファイルは固定で自動読み込みされます。

4. **前に戻る機能**: 一度次に進むと前の動画には戻れません。慎重にアノテーションを行ってください。

5. **必須選択**: Passボタンは削除されており、7つの感情のいずれかを必ず選択する必要があります。

6. **完了後の制限**: 最後の動画でFinishを押すと、感情選択とボタンが無効化され、ダウンロードのみ可能になります。

7. **ローカルファイルアクセス**: ブラウザのセキュリティ制限により、ローカルファイルを直接読み込む場合は、ローカルサーバーを立ち上げることを推奨します。

8. **大きなファイル**: 大量の動画ファイルを扱う場合は、ブラウザのメモリ使用量にご注意ください。

9. **Git管理**: `data/`フォルダの動画ファイルはGitで管理されませんが、`data.csv`は管理されます。

## 実験データとしての活用

このインターフェースは以下の研究用途に適しています：

- **反応時間研究**: アノテーション時間の詳細測定
- **認知負荷研究**: 選択変更回数による迷いの定量化
- **UIパフォーマンス研究**: 動画読み込み時間の測定
- **意思決定研究**: 感情選択からNext押下までの時間分析

## ローカルサーバーの起動方法

### Python 3を使用する場合：
```bash
python -m http.server 8000
```

### Node.jsを使用する場合：
```bash
npx http-server
```

その後、ブラウザで `http://localhost:8000` にアクセスしてください。

## カスタマイズ

### 感情カテゴリの変更
`script.js`の感情リストを変更することで、異なる感情カテゴリに対応できます。

### ログデータのカスタマイズ
`downloadResults()`関数を修正することで、出力するログデータをカスタマイズできます。

## トラブルシューティング

### 動画が読み込まれない場合
1. 動画ファイルのパスが正しいか確認
2. 動画ファイルがサポートされる形式か確認
3. ブラウザの開発者ツールでエラーメッセージを確認

### CSVファイルが読み込まれない場合
1. CSVファイルの形式が正しいか確認
2. 文字エンコーディングがUTF-8か確認
3. ヘッダー行が正しく設定されているか確認

### 自動再生が動作しない場合
1. ブラウザの自動再生ポリシーを確認
2. 音声ありの動画の場合、ユーザー操作が必要な場合があります

## 開発・貢献

### 最新の機能
- ✅ PASSボタンの削除（必須選択）
- ✅ 詳細ログ記録機能
- ✅ Finishボタンと完了時UI制御
- ✅ 自動動画再生
- ✅ 前進のみワークフロー

### Gitワークフロー
```bash
# 変更をコミット
git add .
git commit -m "feat: 新機能の説明"

# リモートにプッシュ
git push origin main
```
